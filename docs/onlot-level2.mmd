flowchart TD
    Client[(API Consumer)] --> Controller[OnLotController\nGET /api/onlot/bylotid]
    Controller --> Normalize[Normalize inputs\n(StringUtils.upperCase)]
    Normalize --> Service[OnLotService.findByLotId]
    Service --> RepoOnLot[OnLotRepository.findByLot]
    RepoOnLot -- Found --> Map[Map entity to OnLotDto\nset Status.FOUND]
    Map --> ControllerResponse[Controller builds ResponseEntity]

    ControllerResponse --> ClientResponse[(HTTP 200 + JSON DTO)]

    RepoOnLot -- Not Found --> Config[Load configs\nOnFabConf / ErtConf / OnSiteConf]
    Config --> Lotg[LotgInfoService.getLotGInfo]
    Config --> Ltm[Caller.getLtm]
    Config --> Mes[TorrentService / GenesisService]
    Config --> Dw[DataWarehouseService queries]
    Config --> SiteRules[OnSiteConfRepository rules]

    Lotg --> Aggregate[Caller.mergeLotData]
    Ltm --> Aggregate
    Mes --> Aggregate
    Dw --> Aggregate
    SiteRules --> Aggregate

    Aggregate --> Persist[Persist updates\nOnLotRepository.save\nOnProdRepository.save]
    Persist --> Map
    Map --> ControllerResponse
